name: Package Folders with Shared Files

on:
  push:
    tags:
      - 'v*'          # 打标签触发
  workflow_dispatch:  # 手动触发选项

permissions:
  contents: write

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare shared files
        run: |
          mkdir -p shared_files
          cp README.md README_en.md img.png shared_files/

      - name: Package each folder
        run: |
          mkdir -p zips
          # 需要打包的文件夹列表
          TARGET_FOLDERS=(
            "MADDPG_Continous"
            "MATD3_Continous"
            "RL_Learning-main"
            "动手学强化学习"   # 保留原始中文名称
          )

          for folder in "${TARGET_FOLDERS[@]}"; do
            if [ -d "$folder" ]; then
              # 为中文文件夹设置英文输出名称
              if [ "$folder" = "动手学强化学习" ]; then
                output_name="hands_on_RL"
              else
                output_name="$folder"
              fi
              
              # 创建临时目录
              mkdir -p "temp_$output_name"
              
              # 复制文件夹内容（保留原始结构）
              cp -r "$folder" "temp_$output_name/"
              
              # 添加共享文件
              cp shared_files/* "temp_$output_name/"
              
              # 打包为英文名称的ZIP
              (cd "temp_$output_name" && zip -r "../zips/$output_name.zip" .)
              echo "✅ Packaged: $folder as $output_name.zip"
            else
              echo "⚠️ Folder not found: $folder"
            fi
          done

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          name: "Release ${{ github.ref_name }}"
          body: "📦 各模块独立下载包（含README和说明图）："
          files: |
            zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
