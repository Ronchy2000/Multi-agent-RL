name: Package Folders with Shared Files

on:
  push:
    tags:
      - 'v*'          # æ‰“æ ‡ç­¾è§¦å‘
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘é€‰é¡¹

permissions:
  contents: write

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare shared files
        run: |
          mkdir -p shared_files
          cp README.md README_en.md img.png shared_files/

      - name: Package each folder
        run: |
          mkdir -p zips
          # éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶å¤¹åˆ—è¡¨
          TARGET_FOLDERS=(
            "MADDPG_Continous"
            "MATD3_Continous"
            "RL_Learning-main"
            "åŠ¨æ‰‹å­¦å¼ºåŒ–å­¦ä¹ "   # ä¿ç•™åŸå§‹ä¸­æ–‡åç§°
          )

          for folder in "${TARGET_FOLDERS[@]}"; do
            if [ -d "$folder" ]; then
              # ä¸ºä¸­æ–‡æ–‡ä»¶å¤¹è®¾ç½®è‹±æ–‡è¾“å‡ºåç§°
              if [ "$folder" = "åŠ¨æ‰‹å­¦å¼ºåŒ–å­¦ä¹ " ]; then
                output_name="hands_on_RL"
              else
                output_name="$folder"
              fi
              
              # åˆ›å»ºä¸´æ—¶ç›®å½•
              mkdir -p "temp_$output_name"
              
              # å¤åˆ¶æ–‡ä»¶å¤¹å†…å®¹ï¼ˆä¿ç•™åŸå§‹ç»“æ„ï¼‰
              cp -r "$folder" "temp_$output_name/"
              
              # æ·»åŠ å…±äº«æ–‡ä»¶
              cp shared_files/* "temp_$output_name/"
              
              # æ‰“åŒ…ä¸ºè‹±æ–‡åç§°çš„ZIP
              (cd "temp_$output_name" && zip -r "../zips/$output_name.zip" .)
              echo "âœ… Packaged: $folder as $output_name.zip"
            else
              echo "âš ï¸ Folder not found: $folder"
            fi
          done

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          name: "Release ${{ github.ref_name }}"
          body: "ğŸ“¦ å„æ¨¡å—ç‹¬ç«‹ä¸‹è½½åŒ…ï¼ˆå«READMEå’Œè¯´æ˜å›¾ï¼‰ï¼š"
          files: |
            zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
