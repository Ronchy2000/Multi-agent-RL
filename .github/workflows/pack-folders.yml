name: Package Folders with Shared Files

on:
  push:
    tags:
      - 'v*'          # æ‰“æ ‡ç­¾è§¦å‘
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘é€‰é¡¹

permissions: # âœ… æ·»åŠ æƒé™é…ç½®
  contents: write  # å…è®¸åˆ›å»ºå’Œæ›´æ–° Release

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare shared files
        run: |
          # å¤åˆ¶å…±äº«æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•
          mkdir -p shared_files
          cp README.md README_en.md img.png shared_files/

      - name: Package each folder
        run: |
          mkdir -p zips
          # éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶å¤¹åˆ—è¡¨ï¼ˆæ’é™¤.gitignoreç­‰ï¼‰
          TARGET_FOLDERS=(
            "MADDPG_Continous"
            # "MAPPO_Continous" 
            "MATD3_Continous"
            "RL_Learning-main"
            "åŠ¨æ‰‹å­¦å¼ºåŒ–å­¦ä¹ "
          )

          for folder in "${TARGET_FOLDERS[@]}"; do
            if [ -d "$folder" ]; then
              # åˆ›å»ºä¸´æ—¶ç›®å½•å¹¶æ”¾å…¥å…±äº«æ–‡ä»¶+å½“å‰æ–‡ä»¶å¤¹
              mkdir -p "temp_$folder"
              cp -r "$folder" "temp_$folder/"
              cp shared_files/* "temp_$folder/"
              
              # æ‰“åŒ…ï¼ˆZIPå†…ä¿ç•™ç›®å½•ç»“æ„ï¼‰
              (cd "temp_$folder" && zip -r "../zips/$folder.zip" .)
              echo "âœ… Packaged: $folder.zip"
            else
              echo "âš ï¸ Folder not found: $folder"
            fi
          done

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          name: "Release ${{ github.ref_name }}"
          body: "ğŸ“¦ å„æ¨¡å—ç‹¬ç«‹ä¸‹è½½åŒ…ï¼ˆå«READMEå’Œè¯´æ˜å›¾ï¼‰ï¼š"
          files: |
            zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
